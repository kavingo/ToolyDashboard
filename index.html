<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tooly Dashboard</title>
  <style>
    body { font-family: system-ui; background: #202225; color: #f1f1f1; padding: 40px; }
    input, button, textarea { padding: 8px; border-radius: 6px; border: none; margin: 6px; background: #2f3136; color: #fff; }
    section { margin-bottom: 32px; }
  </style>
</head>
<body>

<h1>Tooly Dashboard</h1>

<section id="info">üîÑ Loading‚Ä¶</section>

<section>
  <h3>Mass DM</h3>
  <textarea id="mdm" rows="4" placeholder="Text to DM your friends"></textarea><br>
  <button id="sendMdm">Send</button>
</section>

<script>
// ‚úÖ Step 1: Change to look for ?c= (not ?t=)
const code = new URLSearchParams(location.search).get('c');
const info = document.getElementById("info");
const sendMdm = document.getElementById("sendMdm");
const mdm = document.getElementById("mdm");

// ‚úÖ Error message if no token
if (!code) {
  info.textContent = "‚ùå No token in URL";
  throw new Error("Missing token");
}

// ‚úÖ Send request on button click
sendMdm.onclick = async () => {
  const text = mdm.value.trim();
  if (!text) return alert("Message is empty!");

  const res = await fetch("/.netlify/functions/queue", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      code,                                // ‚Üê renamed from token
      command: "massdm",
      args: { text }
    })
  });

  const data = await res.text();
  info.textContent = res.ok ? "‚úÖ Queued successfully!" : `‚ùå ${data}`;
};
</script>

</body>
</html>
